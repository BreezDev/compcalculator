{% extends "base.html" %}
{% block title %}Commission Calculator · Compass Commission Hub{% endblock %}
{% block content %}
<div class="row justify-content-between align-items-center mb-4">
    <div class="col-lg-6">
        <h1 class="h3 fw-bold">Commission &amp; Bonus Calculator</h1>
        <p class="text-muted mb-0">Select a month to instantly see progress toward payouts across commissions and every bonus tier.</p>
    </div>
    <div class="col-lg-4 mt-3 mt-lg-0">
        <form method="get" class="d-flex gap-3">
            <input type="month" class="form-control form-control-lg" name="target_month" value="{{ target_month }}">
            <button class="btn btn-primary btn-lg" type="submit">Update</button>
        </form>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="summary-card">
            <span class="label">P&amp;C Premium</span>
            <span class="value">${{ '%.2f'|format(p_c_premium) }}</span>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            <span class="label">P&amp;C Apps</span>
            <span class="value">{{ p_c_apps }}</span>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            <span class="label">Life Apps</span>
            <span class="value">{{ life_apps }}</span>
        </div>
    </div>
    <div class="col-md-3">
        <div class="summary-card">
            <span class="label">FS Monthly Premium</span>
            <span class="value">${{ '%.2f'|format(fs_monthly_total) }}</span>
        </div>
    </div>
</div>

<div class="glass-card p-4 mb-4">
    <h2 class="h5 fw-semibold mb-3">Commission Overview</h2>
    <p class="mb-3">Commission rate is determined by your number of P&amp;C apps and life apps. Team members must generate $12,000 in P&amp;C premium to unlock commission payouts.</p>
    <div class="row g-3">
        <div class="col-md-4">
            <div class="metric-tile">
                <span class="label">Commission Rate</span>
                <span class="value">{{ (commission_rate * 100)|round(2) }}%</span>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-tile {% if commission_eligible %}bg-success-subtle{% else %}bg-warning-subtle{% endif %}">
                <span class="label">Eligibility</span>
                <span class="value">{% if commission_eligible %}Eligible{% else %}Below $12K P&amp;C{% endif %}</span>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-tile">
                <span class="label">Commission Earned</span>
                <span class="value">${{ '%.2f'|format(commission_amount) }}</span>
            </div>
        </div>
    </div>
</div>

<div class="glass-card p-4 mb-4">
    <h2 class="h5 fw-semibold mb-3">Bonuses</h2>
    <div class="row g-3">
        <div class="col-lg-3 col-sm-6">
            <div class="metric-tile">
                <span class="label">FS Bonus</span>
                <span class="value">${{ '%.2f'|format(fs_monthly_bonus) }}</span>
            </div>
        </div>
        <div class="col-lg-3 col-sm-6">
            <div class="metric-tile">
                <span class="label">FS $1000+ Bonus</span>
                <span class="value">${{ '%.2f'|format(fs_high_bonus) }}</span>
            </div>
        </div>
        <div class="col-lg-3 col-sm-6">
            <div class="metric-tile">
                <span class="label">Life App Bonus</span>
                <span class="value">${{ '%.2f'|format(life_bonus_amount) }}</span>
            </div>
        </div>
        <div class="col-lg-3 col-sm-6">
            <div class="metric-tile">
                <span class="label">Milestone Bonus</span>
                <span class="value">${{ '%.2f'|format(milestone_bonus_amount) }}</span>
            </div>
        </div>
    </div>
</div>

<div class="glass-card p-4 mb-4">
    <div class="row g-3 align-items-center">
        <div class="col-lg-8">
            <h2 class="h5 fw-semibold">Total Variable Compensation</h2>
            <p class="text-muted mb-0">Sum of commission and all bonus opportunities for the selected month (base salary excluded).</p>
        </div>
        <div class="col-lg-4 text-lg-end">
            <div class="metric-tile highlight">
                <span class="label">Total Earned</span>
                <span class="value">${{ '%.2f'|format(total_compensation) }}</span>
            </div>
        </div>
    </div>
</div>

<div class="glass-card p-4">
    <h2 class="h5 fw-semibold mb-3">Sales included in this calculation</h2>
    <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Client</th>
                    <th>Category</th>
                    <th>Date Sold</th>
                    <th>Premium</th>
                    <th>FS Monthly Premium</th>
                </tr>
            </thead>
            <tbody>
                {% if sales %}
                    {% for sale in sales %}
                        <tr>
                            <td>{{ sale.client_name }}</td>
                            <td>{{ categories[sale.category] }}</td>
                            <td>{{ sale.date_sold.strftime('%b %d, %Y') }}</td>
                            <td>${{ '%.2f'|format(sale.premium) }}</td>
                            <td>{% if sale.fs_monthly_premium %}${{ '%.2f'|format(sale.fs_monthly_premium) }}{% else %}<span class="text-muted">—</span>{% endif %}</td>
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" class="text-center py-4 text-muted">No sales captured for this month yet.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
